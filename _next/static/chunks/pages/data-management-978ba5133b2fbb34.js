(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76],{360:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var a=n(7876),r=n(7328),s=n.n(r),o=n(8230),i=n.n(o),c=n(9099);function l(e){let{children:t}=e,n=(0,c.useRouter)();return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-100",children:[(0,a.jsxs)(s(),{children:[(0,a.jsx)("title",{children:"簡易会計システム"}),(0,a.jsx)("meta",{name:"description",content:"簡易会計・確定申告支援システム"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)("header",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"container mx-auto p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(i(),{href:"/",className:"text-2xl font-bold",children:"簡易会計システム"}),(0,a.jsx)("nav",{className:"hidden md:block",children:(0,a.jsx)("ul",{className:"flex space-x-6",children:[{href:"/",label:"ホーム"},{href:"/transactions",label:"仕訳入力"},{href:"/documents",label:"帳票作成"},{href:"/reports",label:"財務レポート"},{href:"/data-management",label:"データ管理"},{href:"/settings",label:"設定"}].map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:e.href,className:"".concat(n.pathname===e.href?"text-blue-500 font-medium":"text-gray-600 hover:text-blue-500"),children:e.label})},e.href))})}),(0,a.jsx)("button",{className:"md:hidden",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-6 h-6",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})})}),(0,a.jsx)("main",{className:"flex-grow py-6",children:t}),(0,a.jsx)("footer",{className:"bg-white shadow-inner mt-auto",children:(0,a.jsx)("div",{className:"container mx-auto p-4 text-center text-gray-600",children:(0,a.jsx)("p",{children:"\xa9 2025 簡易会計システム"})})})]})}},5019:(e,t,n)=>{"use strict";let a,r;n.d(t,{q:()=>N});let s=(e,t)=>t.some(t=>e instanceof t),o=new WeakMap,i=new WeakMap,c=new WeakMap,l={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return o.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let a=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(d(e.result)),a()},s=()=>{n(e.error),a()};e.addEventListener("success",r),e.addEventListener("error",s)});return c.set(t,e),t}(e);if(i.has(e))return i.get(e);let t=function(e){if("function"==typeof e)return(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(u(this),t),d(this.request)}:function(...t){return d(e.apply(u(this),t))};return(e instanceof IDBTransaction&&function(e){if(o.has(e))return;let t=new Promise((t,n)=>{let a=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),a()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});o.set(e,t)}(e),s(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,l):e}(e);return t!==e&&(i.set(e,t),c.set(t,e)),t}let u=e=>c.get(e),m=["get","getKey","getAll","getAllKeys","count"],h=["put","add","delete","clear"],f=new Map;function p(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(f.get(t))return f.get(t);let n=t.replace(/FromIndex$/,""),a=t!==n,r=h.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(r||m.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return a&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return f.set(t,s),s}l=(e=>({...e,get:(t,n,a)=>p(t,n)||e.get(t,n,a),has:(t,n)=>!!p(t,n)||e.has(t,n)}))(l);let g=["continue","continuePrimaryKey","advance"],x={},b=new WeakMap,v=new WeakMap,w={get(e,t){if(!g.includes(t))return e[t];let n=x[t];return n||(n=x[t]=function(...e){b.set(this,v.get(this)[t](...e))}),n}};async function*j(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let n=new Proxy(t,w);for(v.set(n,t),c.set(n,u(t));t;)yield n,t=await (b.get(n)||t.continue()),b.delete(n)}function y(e,t){return t===Symbol.asyncIterator&&s(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&s(e,[IDBIndex,IDBObjectStore])}async function N(){return function(e,t,{blocked:n,upgrade:a,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),i=d(o);return a&&o.addEventListener("upgradeneeded",e=>{a(d(o.result),e.oldVersion,e.newVersion,d(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),i.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),i}("AccountingAppDB",0,{upgrade(e){if(!e.objectStoreNames.contains("transactions")){let t=e.createObjectStore("transactions",{keyPath:"id"});t.createIndex("date","date"),t.createIndex("debitAccount","debitAccount"),t.createIndex("creditAccount","creditAccount")}if(!e.objectStoreNames.contains("documents")){let t=e.createObjectStore("documents",{keyPath:"id"});t.createIndex("type","type"),t.createIndex("date","date")}e.objectStoreNames.contains("settings")||e.createObjectStore("settings",{keyPath:"id"})}})}l=(e=>({...e,get:(t,n,a)=>y(t,n)?j:e.get(t,n,a),has:(t,n)=>y(t,n)||e.has(t,n)}))(l)},6854:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var a=n(7876),r=n(4232),s=n(360),o=n(9473),i=n(5019);async function c(){let e=await (0,i.q)(),t=await e.getAll("transactions");if(0===t.length)throw Error("エクスポートするトランザクションがありません");let n="id,date,description,amount,debitAccount,creditAccount,memo,createdAt\n";t.forEach(e=>{let t=[e.id,e.date,l(e.description),e.amount,l(e.debitAccount),l(e.creditAccount),l(e.memo||""),e.createdAt];n+=t.join(",")+"\n"});let a=new Blob([n],{type:"text/csv;charset=utf-8"}),r=new Date().toISOString().replace(/[:.]/g,"-");(0,o.saveAs)(a,"accounting-transactions-".concat(r,".csv"))}function l(e){return e?e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e:""}async function d(e){return new Promise((t,n)=>{let a=new FileReader;a.onload=async e=>{try{var a;let r=null===(a=e.target)||void 0===a?void 0:a.result;if(!r){n(Error("CSVファイルの読み込みに失敗しました"));return}let s=await u(r);t(s)}catch(e){n(e)}},a.onerror=()=>{n(Error("ファイルの読み込み中にエラーが発生しました"))},a.readAsText(e)})}async function u(e){let t=await (0,i.q)(),n=e.split("\n");if(n.length<2)throw Error("インポートするデータがありません");let a=m(n[0]),r=["id","date","description","amount","debitAccount","creditAccount","memo","createdAt"],s=r.filter(e=>!a.includes(e));if(s.length>0)throw Error("必須ヘッダーが不足しています: ".concat(s.join(", ")));let o=0,c=0,l=[],d=t.transaction("transactions","readwrite");for(let e=1;e<n.length;e++){let t=n[e].trim();if(t)try{let n=m(t);if(n.length<r.length){l.push("行 ".concat(e+1,": 値が不足しています"));continue}let s={};if(a.forEach((e,t)=>{if("amount"===e){let e=parseFloat(n[t]);if(isNaN(e))throw Error("金額の形式が正しくありません: ".concat(n[t]));s.amount=e}else s[e]=n[t]}),!s.id||!s.date||!s.description||void 0===s.amount||isNaN(s.amount)||!s.debitAccount||!s.creditAccount)throw Error("必須フィールドが不足しています");await d.store.get(s.id)?(await d.store.put(s),c++):(await d.store.add(s),o++)}catch(n){let t=n instanceof Error?n.message:"不明なエラーが発生しました";l.push("行 ".concat(e+1,": ").concat(t))}}return await d.done,{added:o,updated:c,errors:l}}function m(e){let t=[],n="",a=!1;for(let r=0;r<e.length;r++){let s=e[r];'"'===s?a&&r<e.length-1&&'"'===e[r+1]?(n+='"',r++):a=!a:","!==s||a?n+=s:(t.push(n),n="")}return t.push(n),t}async function h(){let e=await (0,i.q)(),t=await e.getAll("documents");if(0===t.length)throw Error("エクスポートするドキュメントがありません");let n="id,type,date\n";t.forEach(e=>{let t=[e.id,l(e.type)];n+=t.join(",")+"\n"});let a=new Blob([n],{type:"text/csv;charset=utf-8"}),r=new Date().toISOString().replace(/[:.]/g,"-");(0,o.saveAs)(a,"accounting-documents-".concat(r,".csv"))}async function f(){let e=await (0,i.q)(),t=await e.getAll("settings");if(0===t.length)throw Error("エクスポートする設定がありません");let n="id,value\n";t.forEach(e=>{let t=[e.id,l(JSON.stringify(e.value))];n+=t.join(",")+"\n"});let a=new Blob([n],{type:"text/csv;charset=utf-8"}),r=new Date().toISOString().replace(/[:.]/g,"-");(0,o.saveAs)(a,"accounting-settings-".concat(r,".csv"))}async function p(){try{let e=new(await n.e(524).then(n.t.bind(n,7524,23))).default,t=await (0,i.q)(),a=await t.getAll("transactions");if(a.length>0){let t="id,date,description,amount,debitAccount,creditAccount,memo,createdAt\n";a.forEach(e=>{let n=[e.id,e.date,l(e.description),e.amount,l(e.debitAccount),l(e.creditAccount),l(e.memo||""),e.createdAt];t+=n.join(",")+"\n"}),e.file("transactions.csv",t)}let r=await t.getAll("documents");if(r.length>0){let t="id,type,date\n";r.forEach(e=>{let n=[e.id,l(e.type)];t+=n.join(",")+"\n"}),e.file("documents.csv",t)}let s=await t.getAll("settings");if(s.length>0){let t="id,value\n";s.forEach(e=>{let n=[e.id,l(JSON.stringify(e.value))];t+=n.join(",")+"\n"}),e.file("settings.csv",t)}let c=await e.generateAsync({type:"blob"}),d=new Date().toISOString().replace(/[:.]/g,"-");(0,o.saveAs)(c,"accounting-data-backup-".concat(d,".zip"))}catch(e){throw console.error("データのエクスポート中にエラーが発生しました",e),e}}async function g(e){return new Promise((t,a)=>{let r=new FileReader;r.onload=async e=>{try{var r,s;if(!(null===(r=e.target)||void 0===r?void 0:r.result))return;let a=(await n.e(524).then(n.t.bind(n,7524,23))).default,o=await a.loadAsync(null===(s=e.target)||void 0===s?void 0:s.result),i={transactions:{added:0,updated:0,errors:[]},documents:{added:0,updated:0,errors:[]},settings:{added:0,updated:0,errors:[]}},c=o.file("transactions.csv");if(c){let e=await c.async("string");i.transactions=await u(e)}let l=o.file("documents.csv");if(l){let e=await l.async("string");i.documents=await u(e)}t(i)}catch(e){a(e)}},r.onerror=()=>{a(Error("ファイルの読み込み中にエラーが発生しました"))},r.readAsArrayBuffer(e)})}let x=()=>{let[e,t]=(0,r.useState)(!1),[n,s]=(0,r.useState)(!1),[o,i]=(0,r.useState)(null),[l,u]=(0,r.useState)(null),[m,x]=(0,r.useState)([]),[b,v]=(0,r.useState)("transactions"),w=async e=>{t(!0);try{switch(e){case"transactions":await c();break;case"documents":await h();break;case"settings":await f();break;case"all":await p()}}catch(t){let e=t instanceof Error?t.message:"不明なエラーが発生しました";console.error("エクスポートエラー:",t),alert("エクスポート中にエラーが発生しました: ".concat(e))}finally{t(!1)}},j=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){s(!0),i(null),u(null),x([]);try{if("transactions"===b&&n.name.endsWith(".csv")){let e=await d(n);i(e),x(e.errors)}else if("all"===b&&n.name.endsWith(".zip")){let e=await g(n);u(e);let t=[...e.transactions.errors.map(e=>"[取引] ".concat(e)),...e.documents.errors.map(e=>"[書類] ".concat(e)),...e.settings.errors.map(e=>"[設定] ".concat(e))];x(t)}else throw Error("不適切なファイル形式です。トランザクションはCSV、一括インポートはZIPファイルを選択してください。")}catch(t){let e=t instanceof Error?t.message:"不明なエラーが発生しました";console.error("インポートエラー:",t),x(["ファイル処理中にエラーが発生しました: ".concat(e)])}finally{s(!1),e.target.value=""}}};return(0,a.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"データのエクスポート/インポート"}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"データエクスポート"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsx)("button",{onClick:()=>w("transactions"),disabled:e,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"取引データ"}),(0,a.jsx)("button",{onClick:()=>w("documents"),disabled:!0,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"書類データ"}),(0,a.jsx)("button",{onClick:()=>w("all"),disabled:!0,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"全データ (ZIP)"})]}),e&&(0,a.jsx)("p",{className:"mt-3 text-blue-600",children:"エクスポート処理中..."})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"データインポート"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex gap-4 mb-3",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"importType",value:"transactions",checked:"transactions"===b,onChange:()=>v("transactions"),className:"mr-2"}),"取引データのみ (CSV)"]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"importType",value:"all",checked:"all"===b,onChange:()=>v("all"),className:"mr-2"}),"全データ (ZIP)"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("label",{htmlFor:"importFile",className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 cursor-pointer disabled:opacity-50",children:["ファイルを選択",(0,a.jsx)("input",{type:"file",id:"importFile",onChange:j,accept:"transactions"===b?".csv":".zip",disabled:n,className:"hidden"})]}),(0,a.jsxs)("span",{className:"text-gray-600",children:["transactions"===b?"*.csv ファイル":"*.zip ファイル","を選択してください"]})]})]}),n&&(0,a.jsx)("p",{className:"mt-3 text-blue-600",children:"インポート処理中..."}),o&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"インポート結果:"}),(0,a.jsxs)("p",{children:["新規追加: ",(0,a.jsx)("span",{className:"font-medium",children:o.added})," 件"]}),(0,a.jsxs)("p",{children:["更新: ",(0,a.jsx)("span",{className:"font-medium",children:o.updated})," 件"]}),o.errors.length>0&&(0,a.jsxs)("p",{children:["エラー: ",(0,a.jsx)("span",{className:"font-medium text-red-600",children:o.errors.length})," 件"]})]}),l&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"一括インポート結果:"}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("p",{className:"font-medium",children:"取引データ:"}),(0,a.jsxs)("p",{className:"ml-4",children:["新規追加: ",l.transactions.added," 件, 更新: ",l.transactions.updated," 件"]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("p",{className:"font-medium",children:"書類データ:"}),(0,a.jsxs)("p",{className:"ml-4",children:["新規追加: ",l.documents.added," 件, 更新: ",l.documents.updated," 件"]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("p",{className:"font-medium",children:"設定データ:"}),(0,a.jsxs)("p",{className:"ml-4",children:["新規追加: ",l.settings.added," 件, 更新: ",l.settings.updated," 件"]})]}),(l.transactions.errors.length>0||l.documents.errors.length>0||l.settings.errors.length>0)&&(0,a.jsxs)("p",{className:"text-red-600",children:["エラー: 合計 ",l.transactions.errors.length+l.documents.errors.length+l.settings.errors.length," 件"]})]}),m.length>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h4",{className:"font-bold text-red-600 mb-2",children:"エラーログ:"}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsx)("ul",{className:"list-disc pl-4",children:m.map((e,t)=>(0,a.jsx)("li",{className:"text-red-700 mb-1",children:e},t))})})]})]})]})},b=()=>(0,a.jsx)(s.A,{children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-8 px-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"データ管理"}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("p",{className:"mb-4",children:"このページでは、会計データのバックアップとリストアが行えます。 定期的なバックアップをお勧めします。"})}),(0,a.jsx)(x,{})]})})},8125:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/data-management",function(){return n(6854)}])},9473:function(e,t,n){var a,r,s;r=[],void 0!==(s="function"==typeof(a=function(){"use strict";function t(e,t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){i(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,o=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,n,o){var i=s.URL||s.webkitURL,c=document.createElement("a");n=n||e.name||"download",c.download=n,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?r(c):a(c.href)?t(e,n,o):r(c,c.target="_blank")):(c.href=i.createObjectURL(e),setTimeout(function(){i.revokeObjectURL(c.href)},4e4),setTimeout(function(){r(c)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,s){if(n=n||e.name||"download","string"!=typeof e){var o;navigator.msSaveOrOpenBlob((void 0===(o=s)?o={autoBom:!1}:"object"!=typeof o&&(console.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e),n)}else if(a(e))t(e,n,s);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout(function(){r(i)})}}:function(e,n,a,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,a);var i="application/octet-stream"===e.type,c=/constructor/i.test(s.HTMLElement)||s.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||i&&c||o)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},d.readAsDataURL(e)}else{var u=s.URL||s.webkitURL,m=u.createObjectURL(e);r?r.location=m:location.href=m,r=null,setTimeout(function(){u.revokeObjectURL(m)},4e4)}});s.saveAs=i.saveAs=i,e.exports=i})?a.apply(t,r):a)&&(e.exports=s)}},e=>{var t=t=>e(e.s=t);e.O(0,[8,636,593,792],()=>t(8125)),_N_E=e.O()}]);