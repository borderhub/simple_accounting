(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[603],{360:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var n=s(7876),a=s(7328),r=s.n(a),i=s(8230),l=s.n(i),c=s(9099);function d(e){let{children:t}=e,s=(0,c.useRouter)();return(0,n.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-100",children:[(0,n.jsxs)(r(),{children:[(0,n.jsx)("title",{children:"簡易会計システム"}),(0,n.jsx)("meta",{name:"description",content:"簡易会計・確定申告支援システム"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)("header",{className:"bg-white shadow",children:(0,n.jsx)("div",{className:"container mx-auto p-4",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)(l(),{href:"/",className:"text-2xl font-bold",children:"簡易会計システム"}),(0,n.jsx)("nav",{className:"hidden md:block",children:(0,n.jsx)("ul",{className:"flex space-x-6",children:[{href:"/",label:"ホーム"},{href:"/transactions",label:"仕訳入力"},{href:"/documents",label:"帳票作成"},{href:"/reports",label:"財務レポート"},{href:"/data-management",label:"データ管理"}].map(e=>(0,n.jsx)("li",{children:(0,n.jsx)(l(),{href:e.href,className:"".concat(s.pathname===e.href?"text-blue-500 font-medium":"text-gray-600 hover:text-blue-500"),children:e.label})},e.href))})}),(0,n.jsx)("button",{className:"md:hidden",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-6 h-6",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})})}),(0,n.jsx)("main",{className:"flex-grow py-6",children:t}),(0,n.jsx)("footer",{className:"bg-white shadow-inner mt-auto",children:(0,n.jsx)("div",{className:"container mx-auto p-4 text-center text-gray-600",children:(0,n.jsx)("p",{children:"\xa9 2025 簡易会計システム"})})})]})}},5019:(e,t,s)=>{"use strict";let n,a;s.d(t,{q:()=>y});let r=(e,t)=>t.some(t=>e instanceof t),i=new WeakMap,l=new WeakMap,c=new WeakMap,d={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return o(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function o(e){if(e instanceof IDBRequest)return function(e){let t=new Promise((t,s)=>{let n=()=>{e.removeEventListener("success",a),e.removeEventListener("error",r)},a=()=>{t(o(e.result)),n()},r=()=>{s(e.error),n()};e.addEventListener("success",a),e.addEventListener("error",r)});return c.set(t,e),t}(e);if(l.has(e))return l.get(e);let t=function(e){if("function"==typeof e)return(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(u(this),t),o(this.request)}:function(...t){return o(e.apply(u(this),t))};return(e instanceof IDBTransaction&&function(e){if(i.has(e))return;let t=new Promise((t,s)=>{let n=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",r),e.removeEventListener("abort",r)},a=()=>{t(),n()},r=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",a),e.addEventListener("error",r),e.addEventListener("abort",r)});i.set(e,t)}(e),r(e,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,d):e}(e);return t!==e&&(l.set(e,t),c.set(t,e)),t}let u=e=>c.get(e),m=["get","getKey","getAll","getAllKeys","count"],h=["put","add","delete","clear"],x=new Map;function p(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(x.get(t))return x.get(t);let s=t.replace(/FromIndex$/,""),n=t!==s,a=h.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(a||m.includes(s)))return;let r=async function(e,...t){let r=this.transaction(e,a?"readwrite":"readonly"),i=r.store;return n&&(i=i.index(t.shift())),(await Promise.all([i[s](...t),a&&r.done]))[0]};return x.set(t,r),r}d=(e=>({...e,get:(t,s,n)=>p(t,s)||e.get(t,s,n),has:(t,s)=>!!p(t,s)||e.has(t,s)}))(d);let b=["continue","continuePrimaryKey","advance"],j={},f=new WeakMap,N=new WeakMap,v={get(e,t){if(!b.includes(t))return e[t];let s=j[t];return s||(s=j[t]=function(...e){f.set(this,N.get(this)[t](...e))}),s}};async function*g(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let s=new Proxy(t,v);for(N.set(s,t),c.set(s,u(t));t;)yield s,t=await (f.get(s)||t.continue()),f.delete(s)}function w(e,t){return t===Symbol.asyncIterator&&r(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&r(e,[IDBIndex,IDBObjectStore])}async function y(){return function(e,t,{blocked:s,upgrade:n,blocking:a,terminated:r}={}){let i=indexedDB.open(e,1),l=o(i);return n&&i.addEventListener("upgradeneeded",e=>{n(o(i.result),e.oldVersion,e.newVersion,o(i.transaction),e)}),s&&i.addEventListener("blocked",e=>s(e.oldVersion,e.newVersion,e)),l.then(e=>{r&&e.addEventListener("close",()=>r()),a&&e.addEventListener("versionchange",e=>a(e.oldVersion,e.newVersion,e))}).catch(()=>{}),l}("AccountingAppDB",0,{upgrade(e){if(!e.objectStoreNames.contains("transactions")){let t=e.createObjectStore("transactions",{keyPath:"id"});t.createIndex("date","date"),t.createIndex("debitAccount","debitAccount"),t.createIndex("creditAccount","creditAccount")}if(!e.objectStoreNames.contains("documents")){let t=e.createObjectStore("documents",{keyPath:"id"});t.createIndex("type","type"),t.createIndex("date","date")}e.objectStoreNames.contains("settings")||e.createObjectStore("settings",{keyPath:"id"})}})}d=(e=>({...e,get:(t,s,n)=>w(t,s)?g:e.get(t,s,n),has:(t,s)=>w(t,s)||e.has(t,s)}))(d)},6328:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/documents/new-invoice",function(){return s(8382)}])},8382:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var n=s(7876),a=s(4232),r=s(9099),i=s(360),l=s(5019);function c(){var e,t,s;let c=(0,r.useRouter)(),[d,o]=(0,a.useState)(!1),[u,m]=(0,a.useState)(""),[h,x]=(0,a.useState)([]),[p]=(0,a.useState)([{id:"1",name:"株式会社サンプル",address:"東京都千代田区1-1-1",email:"info@sample.co.jp"},{id:"2",name:"テスト商事",address:"大阪府大阪市中央区2-2-2",email:"contact@test.co.jp"}]),[b,j]=(0,a.useState)({invoiceNumber:"INV-".concat(new Date().getFullYear()).concat((new Date().getMonth()+1).toString().padStart(2,"0")).concat(Math.floor(1e3*Math.random()).toString().padStart(3,"0")),issueDate:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+2592e6).toISOString().split("T")[0],clientId:"",items:[{description:"",quantity:1,unitPrice:0,amount:0,taxRate:10}],memo:"",subTotal:0,taxTotal:0,total:0,paymentTerms:"請求書発行日より30日以内にお支払いください。",bankInfo:"〇〇銀行 △△支店 普通 1234567 カブシキガイシャ〇〇"}),[f]=(0,a.useState)({name:"株式会社〇〇",address:"東京都新宿区西新宿1-1-1",phone:"03-1234-5678",email:"info@example.com",website:"www.example.com",taxId:"1234567890123"});(0,a.useEffect)(()=>{!async function(){try{let e=(await (0,l.q)()).transaction("transactions","readonly").objectStore("transactions"),t=(await e.getAll()).filter(e=>"売上"===e.creditAccount||"売掛金"===e.debitAccount);x(t.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}catch(e){console.error("取引データの取得に失敗しました:",e),m("取引データの取得に失敗しました。")}}()},[]);let N=e=>{let t=[...b.items];t.splice(e,1),j(e=>({...e,items:t})),g(t)},v=(e,t,s)=>{let n=[...b.items];if("unitPrice"===t||"quantity"===t){let a=parseFloat(s)||0;n[e][t]=a,n[e].amount=n[e].quantity*n[e].unitPrice}else if("taxRate"===t){let a=parseFloat(s)||0;n[e][t]=a}else"description"===t&&(n[e][t]=s);j(e=>({...e,items:n})),g(n)},g=e=>{let t=e.reduce((e,t)=>e+t.amount,0),s=e.reduce((e,t)=>e+t.amount*(t.taxRate/100),0),n=t+s;j(e=>({...e,subTotal:t,taxTotal:s,total:n}))},w=e=>{let t={description:e.description,quantity:1,unitPrice:e.amount,amount:e.amount,taxRate:10},s=[...b.items,t];j(e=>({...e,items:s})),g(s)},y=async e=>{e.preventDefault(),o(!0),m("");try{let e=(await (0,l.q)()).transaction("documents","readwrite"),t=e.objectStore("documents"),s=p.find(e=>e.id===b.clientId),n={...b,id:"invoice-".concat(Date.now()),type:"invoice",status:"issued",issueDate:new Date(b.issueDate),dueDate:new Date(b.dueDate),createdAt:new Date,client:s,company:f};await t.add(n),await e.oncomplete,c.push("/documents/history")}catch(e){console.error("請求書の保存に失敗しました:",e),m("請求書の保存中にエラーが発生しました。再試行してください。")}finally{o(!1)}};return(0,n.jsx)(i.A,{children:(0,n.jsxs)("div",{className:"container mx-auto p-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"請求書作成"}),u&&(0,n.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:u}),(0,n.jsx)("div",{className:"mb-6 bg-white p-6 rounded shadow",children:(0,n.jsxs)("form",{onSubmit:y,children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"請求書情報"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"請求書番号"}),(0,n.jsx)("input",{type:"text",value:b.invoiceNumber,onChange:e=>j({...b,invoiceNumber:e.target.value}),className:"w-full p-2 border rounded",required:!0})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"発行日"}),(0,n.jsx)("input",{type:"date",value:b.issueDate,onChange:e=>j({...b,issueDate:e.target.value}),className:"w-full p-2 border rounded",required:!0})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"支払期限"}),(0,n.jsx)("input",{type:"date",value:b.dueDate,onChange:e=>j({...b,dueDate:e.target.value}),className:"w-full p-2 border rounded",required:!0})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"請求先情報"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"請求先"}),(0,n.jsxs)("select",{value:b.clientId,onChange:e=>j({...b,clientId:e.target.value}),className:"w-full p-2 border rounded",required:!0,children:[(0,n.jsx)("option",{value:"",children:"請求先を選択してください"}),p.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),b.clientId&&(0,n.jsxs)("div",{className:"p-3 bg-gray-50 rounded",children:[(0,n.jsx)("p",{className:"font-medium",children:null===(e=p.find(e=>e.id===b.clientId))||void 0===e?void 0:e.name}),(0,n.jsx)("p",{children:null===(t=p.find(e=>e.id===b.clientId))||void 0===t?void 0:t.address}),(0,n.jsx)("p",{children:null===(s=p.find(e=>e.id===b.clientId))||void 0===s?void 0:s.email})]})]})]}),(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"請求項目"}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"p-2 text-left",children:"内容"}),(0,n.jsx)("th",{className:"p-2 text-center w-20",children:"数量"}),(0,n.jsx)("th",{className:"p-2 text-right w-32",children:"単価"}),(0,n.jsx)("th",{className:"p-2 text-right w-32",children:"金額"}),(0,n.jsx)("th",{className:"p-2 text-center w-24",children:"税率(%)"}),(0,n.jsx)("th",{className:"p-2 text-center w-20",children:"操作"})]})}),(0,n.jsx)("tbody",{children:b.items.map((e,t)=>(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("td",{className:"p-2",children:(0,n.jsx)("input",{type:"text",value:e.description,onChange:e=>v(t,"description",e.target.value),className:"w-full p-1 border rounded",placeholder:"項目の説明",required:!0})}),(0,n.jsx)("td",{className:"p-2",children:(0,n.jsx)("input",{type:"number",value:e.quantity,onChange:e=>v(t,"quantity",e.target.value),className:"w-full p-1 border rounded text-center",min:"1",required:!0})}),(0,n.jsx)("td",{className:"p-2",children:(0,n.jsx)("input",{type:"number",value:e.unitPrice,onChange:e=>v(t,"unitPrice",e.target.value),className:"w-full p-1 border rounded text-right",min:"0",required:!0})}),(0,n.jsxs)("td",{className:"p-2 text-right font-medium",children:[e.amount.toLocaleString(),"円"]}),(0,n.jsx)("td",{className:"p-2",children:(0,n.jsxs)("select",{value:e.taxRate,onChange:e=>v(t,"taxRate",e.target.value),className:"w-full p-1 border rounded text-center",children:[(0,n.jsx)("option",{value:"0",children:"0%"}),(0,n.jsx)("option",{value:"8",children:"8%"}),(0,n.jsx)("option",{value:"10",children:"10%"})]})}),(0,n.jsx)("td",{className:"p-2 text-center",children:t>0&&(0,n.jsx)("button",{type:"button",onClick:()=>N(t),className:"text-red-500 hover:text-red-700",children:"削除"})})]},t))}),(0,n.jsx)("tfoot",{children:(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:6,className:"pt-2",children:(0,n.jsx)("button",{type:"button",onClick:()=>{j(e=>({...e,items:[...e.items,{description:"",quantity:1,unitPrice:0,amount:0,taxRate:10}]}))},className:"text-blue-500 hover:text-blue-700",children:"+ 項目を追加"})})})})]})})}),(0,n.jsx)("div",{className:"flex justify-end mb-6",children:(0,n.jsxs)("div",{className:"w-64",children:[(0,n.jsxs)("div",{className:"flex justify-between py-2 border-b",children:[(0,n.jsx)("span",{children:"小計:"}),(0,n.jsxs)("span",{className:"font-medium",children:[b.subTotal.toLocaleString(),"円"]})]}),(0,n.jsxs)("div",{className:"flex justify-between py-2 border-b",children:[(0,n.jsx)("span",{children:"消費税:"}),(0,n.jsxs)("span",{className:"font-medium",children:[b.taxTotal.toLocaleString(),"円"]})]}),(0,n.jsxs)("div",{className:"flex justify-between py-2 text-lg font-bold",children:[(0,n.jsx)("span",{children:"合計:"}),(0,n.jsxs)("span",{children:[b.total.toLocaleString(),"円"]})]})]})}),(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"追加情報"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"支払い条件"}),(0,n.jsx)("textarea",{value:b.paymentTerms,onChange:e=>j({...b,paymentTerms:e.target.value}),className:"w-full p-2 border rounded",rows:2})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"振込先情報"}),(0,n.jsx)("textarea",{value:b.bankInfo,onChange:e=>j({...b,bankInfo:e.target.value}),className:"w-full p-2 border rounded",rows:2})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"備考"}),(0,n.jsx)("textarea",{value:b.memo,onChange:e=>j({...b,memo:e.target.value}),className:"w-full p-2 border rounded",rows:3,placeholder:"請求書に関する補足情報"})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,n.jsx)("button",{type:"button",onClick:()=>c.back(),className:"px-4 py-2 border rounded",disabled:d,children:"キャンセル"}),(0,n.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:d||0===b.items.length||!b.clientId,children:d?"保存中...":"請求書を保存"})]})]})}),(0,n.jsxs)("div",{className:"mt-8 bg-white p-6 rounded shadow",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"関連する売上取引データ"}),h.length>0?(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"p-2 text-left",children:"日付"}),(0,n.jsx)("th",{className:"p-2 text-left",children:"摘要"}),(0,n.jsx)("th",{className:"p-2 text-right",children:"金額"}),(0,n.jsx)("th",{className:"p-2 text-center",children:"アクション"})]})}),(0,n.jsx)("tbody",{children:h.slice(0,5).map(e=>(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("td",{className:"p-2",children:new Date(e.date).toLocaleDateString()}),(0,n.jsx)("td",{className:"p-2",children:e.description}),(0,n.jsxs)("td",{className:"p-2 text-right",children:[e.amount.toLocaleString(),"円"]}),(0,n.jsx)("td",{className:"p-2 text-center",children:(0,n.jsx)("button",{type:"button",onClick:()=>w(e),className:"text-blue-500 hover:text-blue-700",children:"項目に追加"})})]},e.id))})]})}):(0,n.jsx)("p",{children:"関連する取引データがありません。"})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8,636,593,792],()=>t(6328)),_N_E=e.O()}]);