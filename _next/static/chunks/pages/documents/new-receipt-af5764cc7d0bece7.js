(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[358],{360:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var a=n(7876),r=n(7328),s=n.n(r),o=n(8230),l=n.n(o),i=n(9099);function d(e){let{children:t}=e,n=(0,i.useRouter)();return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-100",children:[(0,a.jsxs)(s(),{children:[(0,a.jsx)("title",{children:"簡易会計システム"}),(0,a.jsx)("meta",{name:"description",content:"簡易会計・確定申告支援システム"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)("header",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"container mx-auto p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(l(),{href:"/",className:"text-2xl font-bold",children:"簡易会計システム"}),(0,a.jsx)("nav",{className:"hidden md:block",children:(0,a.jsx)("ul",{className:"flex space-x-6",children:[{href:"/",label:"ホーム"},{href:"/transactions",label:"仕訳入力"},{href:"/documents",label:"帳票作成"},{href:"/reports",label:"財務レポート"},{href:"/data-management",label:"データ管理"}].map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(l(),{href:e.href,className:"".concat(n.pathname===e.href?"text-blue-500 font-medium":"text-gray-600 hover:text-blue-500"),children:e.label})},e.href))})}),(0,a.jsx)("button",{className:"md:hidden",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-6 h-6",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})})}),(0,a.jsx)("main",{className:"flex-grow py-6",children:t}),(0,a.jsx)("footer",{className:"bg-white shadow-inner mt-auto",children:(0,a.jsx)("div",{className:"container mx-auto p-4 text-center text-gray-600",children:(0,a.jsx)("p",{children:"\xa9 2025 簡易会計システム"})})})]})}},1956:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/documents/new-receipt",function(){return n(7111)}])},5019:(e,t,n)=>{"use strict";let a,r;n.d(t,{q:()=>w});let s=(e,t)=>t.some(t=>e instanceof t),o=new WeakMap,l=new WeakMap,i=new WeakMap,d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return o.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return c(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function c(e){if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let a=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(c(e.result)),a()},s=()=>{n(e.error),a()};e.addEventListener("success",r),e.addEventListener("error",s)});return i.set(t,e),t}(e);if(l.has(e))return l.get(e);let t=function(e){if("function"==typeof e)return(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(u(this),t),c(this.request)}:function(...t){return c(e.apply(u(this),t))};return(e instanceof IDBTransaction&&function(e){if(o.has(e))return;let t=new Promise((t,n)=>{let a=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),a()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});o.set(e,t)}(e),s(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,d):e}(e);return t!==e&&(l.set(e,t),i.set(t,e)),t}let u=e=>i.get(e),m=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],x=new Map;function h(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(x.get(t))return x.get(t);let n=t.replace(/FromIndex$/,""),a=t!==n,r=b.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(r||m.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return a&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return x.set(t,s),s}d=(e=>({...e,get:(t,n,a)=>h(t,n)||e.get(t,n,a),has:(t,n)=>!!h(t,n)||e.has(t,n)}))(d);let p=["continue","continuePrimaryKey","advance"],f={},j=new WeakMap,y=new WeakMap,g={get(e,t){if(!p.includes(t))return e[t];let n=f[t];return n||(n=f[t]=function(...e){j.set(this,y.get(this)[t](...e))}),n}};async function*N(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let n=new Proxy(t,g);for(y.set(n,t),i.set(n,u(t));t;)yield n,t=await (j.get(n)||t.continue()),j.delete(n)}function v(e,t){return t===Symbol.asyncIterator&&s(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&s(e,[IDBIndex,IDBObjectStore])}async function w(){return function(e,t,{blocked:n,upgrade:a,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),l=c(o);return a&&o.addEventListener("upgradeneeded",e=>{a(c(o.result),e.oldVersion,e.newVersion,c(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),l.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),l}("AccountingAppDB",0,{upgrade(e){if(!e.objectStoreNames.contains("transactions")){let t=e.createObjectStore("transactions",{keyPath:"id"});t.createIndex("date","date"),t.createIndex("debitAccount","debitAccount"),t.createIndex("creditAccount","creditAccount")}if(!e.objectStoreNames.contains("documents")){let t=e.createObjectStore("documents",{keyPath:"id"});t.createIndex("type","type"),t.createIndex("date","date")}e.objectStoreNames.contains("settings")||e.createObjectStore("settings",{keyPath:"id"})}})}d=(e=>({...e,get:(t,n,a)=>v(t,n)?N:e.get(t,n,a),has:(t,n)=>v(t,n)||e.has(t,n)}))(d)},7111:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var a=n(7876),r=n(4232),s=n(9099),o=n(360),l=n(5019);function i(){let e=(0,s.useRouter)(),{transaction:t}=e.query,[n,i]=(0,r.useState)({title:"領収書",receiptNumber:"R-".concat(Date.now().toString().slice(-6)),date:new Date().toISOString().split("T")[0],issuedTo:"",amount:0,paymentMethod:"現金",description:"",items:[{description:"",amount:0,quantity:1,total:0}],tax:10,companyName:"株式会社サンプル",companyAddress:"東京都渋谷区渋谷1-1-1",companyPhone:"03-1234-5678",companyEmail:"info@example.com",bankInfo:"三菱UFJ銀行 渋谷支店 普通 1234567",memo:""}),[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)("");(0,r.useEffect)(()=>{!async function(){try{if(!t||Array.isArray(t))return;let e=(await (0,l.q)()).transaction("transactions","readonly").objectStore("transactions"),a=await e.get(t);a&&i({...n,date:new Date(a.date).toISOString().split("T")[0],amount:Number(a.amount),description:a.description,items:[{description:a.description,amount:Number(a.amount),quantity:1,total:Number(a.amount)}]})}catch(e){console.error("取引データの取得に失敗しました:",e)}}()},[t]);let b=e=>{let{name:t,value:a}=e.target;i({...n,[t]:"amount"===t||"tax"===t?""===a?0:Number(a):a})},x=(e,t,a)=>{let r=[...n.items],s=r[e];"amount"===t||"quantity"===t?(a=""===a?0:Number(a),s[t]=a,"number"==typeof s.amount&&"number"==typeof s.quantity&&(s.total=s.amount*s.quantity)):"description"===t&&(s[t]=a);let o=r.reduce((e,t)=>e+(t.total||0),0);i({...n,items:r,amount:o})},h=e=>{if(n.items.length<=1)return;let t=n.items.filter((t,n)=>n!==e),a=t.reduce((e,t)=>e+(t.total||0),0);i({...n,items:t,amount:a})},p=()=>Math.round(n.amount*(n.tax/100)),f=()=>n.amount+p(),j=async a=>{a.preventDefault(),c(!0),m("");try{let a=(await (0,l.q)()).transaction("documents","readwrite"),r=a.objectStore("documents"),s={...n,id:"receipt-".concat(Date.now()),type:"receipt",date:new Date(n.date).toISOString(),createdAt:new Date,totalAmount:f(),taxAmount:p(),transactionId:t||null};await r.add(s),await a.oncomplete,e.push("/documents/".concat(s.id))}catch(e){console.error("領収書の保存に失敗しました:",e),m("領収書の保存中にエラーが発生しました。再試行してください。"),c(!1)}};return(0,a.jsx)(o.A,{children:(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"領収書の作成"}),u&&(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:u}),(0,a.jsxs)("form",{onSubmit:j,className:"bg-white p-6 rounded shadow",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"タイトル"}),(0,a.jsx)("input",{type:"text",name:"title",value:n.title,onChange:b,required:!0,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"領収書番号"}),(0,a.jsx)("input",{type:"text",name:"receiptNumber",value:n.receiptNumber,onChange:b,required:!0,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"発行日"}),(0,a.jsx)("input",{type:"date",name:"date",value:n.date,onChange:b,required:!0,className:"w-full p-2 border rounded"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"宛先"}),(0,a.jsx)("input",{type:"text",name:"issuedTo",value:n.issuedTo,onChange:b,required:!0,placeholder:"会社名または個人名",className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"font-medium mb-2",children:"明細項目"}),n.items.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-wrap items-end gap-2 mb-2 p-2 border rounded",children:[(0,a.jsxs)("div",{className:"w-full md:w-5/12",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"摘要"}),(0,a.jsx)("input",{type:"text",value:e.description,onChange:e=>x(t,"description",e.target.value),className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{className:"w-full md:w-2/12",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"単価"}),(0,a.jsx)("input",{type:"number",value:e.amount,onChange:e=>x(t,"amount",e.target.value),className:"w-full p-2 border rounded",min:"0",required:!0})]}),(0,a.jsxs)("div",{className:"w-full md:w-1/12",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"数量"}),(0,a.jsx)("input",{type:"number",value:e.quantity,onChange:e=>x(t,"quantity",e.target.value),className:"w-full p-2 border rounded",min:"1",required:!0})]}),(0,a.jsxs)("div",{className:"w-full md:w-2/12",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"小計"}),(0,a.jsx)("input",{type:"text",value:"number"==typeof e.total?e.total.toLocaleString():"",className:"w-full p-2 border rounded bg-gray-100",readOnly:!0})]}),(0,a.jsx)("div",{className:"w-full md:w-auto",children:(0,a.jsx)("button",{type:"button",onClick:()=>h(t),className:"p-2 bg-red-50 text-red-500 rounded border border-red-200 hover:bg-red-100",disabled:n.items.length<=1,children:"削除"})})]},t)),(0,a.jsx)("button",{type:"button",onClick:()=>{i({...n,items:[...n.items,{description:"",amount:0,quantity:1,total:0}]})},className:"mt-2 px-4 py-2 bg-gray-100 text-gray-700 rounded border hover:bg-gray-200",children:"+ 項目を追加"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"お支払い方法"}),(0,a.jsxs)("select",{name:"paymentMethod",value:n.paymentMethod,onChange:b,className:"w-full p-2 border rounded",children:[(0,a.jsx)("option",{value:"現金",children:"現金"}),(0,a.jsx)("option",{value:"銀行振込",children:"銀行振込"}),(0,a.jsx)("option",{value:"クレジットカード",children:"クレジットカード"}),(0,a.jsx)("option",{value:"電子マネー",children:"電子マネー"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"消費税率 (%)"}),(0,a.jsx)("input",{type:"number",name:"tax",value:n.tax,onChange:b,className:"w-full p-2 border rounded",min:"0",max:"100"})]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{children:"小計:"}),(0,a.jsxs)("span",{children:["number"==typeof n.amount?n.amount.toLocaleString():0,"円"]})]}),(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsxs)("span",{children:["消費税(",n.tax,"%):"]}),(0,a.jsxs)("span",{children:[p().toLocaleString(),"円"]})]}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"合計金額:"}),(0,a.jsxs)("span",{children:[f().toLocaleString(),"円"]})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"会社名"}),(0,a.jsx)("input",{type:"text",name:"companyName",value:n.companyName,onChange:b,className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"住所"}),(0,a.jsx)("input",{type:"text",name:"companyAddress",value:n.companyAddress,onChange:b,className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"電話番号"}),(0,a.jsx)("input",{type:"text",name:"companyPhone",value:n.companyPhone,onChange:b,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"メールアドレス"}),(0,a.jsx)("input",{type:"email",name:"companyEmail",value:n.companyEmail,onChange:b,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"銀行情報"}),(0,a.jsx)("input",{type:"text",name:"bankInfo",value:n.bankInfo,onChange:b,className:"w-full p-2 border rounded"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block mb-2 font-medium",children:"備考"}),(0,a.jsx)("textarea",{name:"memo",value:n.memo,onChange:b,className:"w-full p-2 border rounded",rows:3,placeholder:"その他の情報や注意事項など"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{type:"button",onClick:()=>e.back(),className:"px-4 py-2 border rounded",disabled:d,children:"キャンセル"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{alert("この機能はまだ実装されていません。")},className:"px-4 py-2 border bg-gray-100 rounded hover:bg-gray-200",disabled:d,children:"プレビュー"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:d,children:d?"保存中...":"保存する"})]})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8,636,593,792],()=>t(1956)),_N_E=e.O()}]);